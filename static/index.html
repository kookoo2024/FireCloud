<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>FireCloud</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg0: #0a0a0f;
            --bg1: #111119;
            --bg2: #1a1a25;
            --bg3: #242434;
            --bg4: #2e2e42;
            --accent: #7c6aff;
            --accent2: #a78bfa;
            --glow: rgba(124, 106, 255, .2);
            --t1: #eeeef2;
            --t2: #97979f;
            --t3: #55555f;
            --border: rgba(255, 255, 255, .06);
            --green: #34d399;
            --red: #f87171;
            --r: 12px;
            --rs: 8px;
            --tr: .2s cubic-bezier(.4, 0, .2, 1)
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg0);
            color: var(--t1);
            min-height: 100vh;
            overflow-x: hidden
        }

        button {
            cursor: pointer;
            font-family: inherit
        }

        ::-webkit-scrollbar {
            width: 5px
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg4);
            border-radius: 3px
        }

        /* === È°∂Ê†è === */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            height: 56px;
            padding: 0 24px;
            background: rgba(10, 10, 15, .88);
            backdrop-filter: blur(24px) saturate(1.5);
            border-bottom: 1px solid var(--border)
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #ff6b6b, var(--accent), #38bdf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-right: 8px;
            white-space: nowrap;
            flex-shrink: 0;
            cursor: pointer;
            text-decoration: none
        }

        .back-btn {
            width: 34px;
            height: 34px;
            border-radius: var(--rs);
            border: 1px solid var(--border);
            background: var(--bg2);
            color: var(--t2);
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--tr);
            margin-right: 8px;
            flex-shrink: 0
        }

        .back-btn:hover {
            background: var(--bg3);
            color: var(--t1)
        }

        .back-btn.hidden {
            display: none
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            min-width: 0;
            overflow-x: auto;
            padding: 4px 0
        }

        .nav a,
        .nav span {
            font-size: 13px;
            padding: 5px 10px;
            border-radius: 6px;
            white-space: nowrap;
            transition: all var(--tr)
        }

        .nav a {
            color: var(--t2)
        }

        .nav a:hover {
            color: var(--t1);
            background: var(--bg3)
        }

        .nav .sep {
            color: var(--t3);
            font-size: 10px;
            padding: 0 2px
        }

        .nav .cur {
            color: var(--t1);
            font-weight: 600;
            background: var(--bg3);
            padding: 5px 12px
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            flex-shrink: 0
        }

        .icon-btn {
            width: 38px;
            height: 38px;
            border-radius: var(--rs);
            border: 1px solid var(--border);
            background: var(--bg2);
            color: var(--t2);
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--tr)
        }

        .icon-btn:hover {
            background: var(--bg3);
            color: var(--t1);
            border-color: rgba(255, 255, 255, .1)
        }

        .ip-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0 12px;
            height: 38px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--t2);
            font-size: 13px;
            font-weight: 500;
            text-decoration: none;
            transition: all var(--tr);
            cursor: pointer
        }

        .ip-badge:hover {
            background: var(--bg3);
            color: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--glow)
        }

        .ip-badge span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 8px var(--green)
        }

        /* === ‰∏ªÂÜÖÂÆπ === */
        .main {
            padding: 20px 24px;
            min-height: calc(100vh - 56px);
            position: relative
        }

        /* ÊãñÊãΩË¶ÜÁõñÂ±ÇÔºà‰ªÖÊãñÊãΩÊó∂ÊòæÁ§∫Ôºâ */
        .drag-overlay {
            position: fixed;
            inset: 0;
            z-index: 90;
            background: rgba(10, 10, 15, .85);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            pointer-events: none
        }

        .drag-overlay.show {
            display: flex
        }

        .drag-box {
            padding: 48px 64px;
            border: 2px dashed var(--accent);
            border-radius: 20px;
            text-align: center;
            background: rgba(124, 106, 255, .04);
            animation: pulse 2s infinite
        }

        @keyframes pulse {

            0%,
            100% {
                border-color: var(--accent)
            }

            50% {
                border-color: var(--accent2)
            }
        }

        .drag-box p:first-child {
            font-size: 48px;
            margin-bottom: 12px
        }

        .drag-box p:last-child {
            font-size: 15px;
            color: var(--accent2);
            font-weight: 500
        }

        /* === ÁõÆÂΩïÈ°µ Chips (ÂàÜÁ±ªÊ†áÁ≠æ) === */
        .chips {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
            scrollbar-width: none
        }

        .chips::-webkit-scrollbar {
            display: none
        }

        .chip {
            padding: 7px 14px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            color: #f1f1f1;
            transition: all 0.2s
        }

        .chip.act {
            background: #fff;
            color: #000;
            border-color: #fff
        }

        .chip:hover:not(.act) {
            background: var(--bg4)
        }

        /* === ËßÜÈ¢ëÂç°ÁâáÁΩëÊ†º === */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px 16px
        }

        .item {
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.2s;
            border-radius: 12px;
            overflow: visible;
            position: relative
        }

        /* Â∞ÅÈù¢ÂõæÂÆπÂô® */
        .thumb-box {
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 12px;
            background: #222;
            overflow: hidden;
            position: relative;
            margin-bottom: 12px
        }

        .thumb-box img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.4s
        }

        .item:hover .thumb-box img {
            transform: scale(1.03)
        }

        /* Â§ßÂ∞èÊ†áËÆ∞ (‰ªøÊó∂Èïø) */
        .size-tag {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            z-index: 2
        }

        /* Âç°ÁâáÂÜÖÂÆπÂå∫ */
        .card-body {
            display: flex;
            gap: 12px;
            padding: 0 4px
        }

        .card-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0
        }

        .card-text {
            flex: 1;
            min-width: 0
        }

        .fname {
            font-size: 15px;
            font-weight: 600;
            line-height: 1.4;
            color: #fff;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-break: break-all
        }

        .fmeta {
            font-size: 13px;
            color: #aaa;
            line-height: 1.2
        }

        /* ËèúÂçïÊåâÈíÆ (‰ªø‰∏âÁÇπ) */
        .card-menu {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-size: 20px;
            border-radius: 50%;
            transition: background 0.2s
        }

        .card-menu:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff
        }

        /* ÈÄâ‰∏≠Áä∂ÊÄÅ */
        .item.sel .thumb-box {
            border: 3px solid var(--accent);
            padding: 2px;
            background: var(--accent)
        }

        .item .ck {
            display: none
        }

        /* ÈöêËóèÊóßÁöÑÈÄâÊã©Ê°ÜÔºåÊîπÁî®ËèúÂçïÂãæÈÄâ */

        .empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 100px 20px;
            color: var(--t3);
            grid-column: 1/-1
        }

        .empty span {
            font-size: 72px;
            margin-bottom: 16px;
            opacity: .3
        }

        /* === ‰∏ä‰º†ËèúÂçï === */
        .upload-menu {
            position: absolute;
            top: 48px;
            right: 0;
            width: 220px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: var(--r);
            box-shadow: 0 12px 40px rgba(0, 0, 0, .5);
            display: none;
            z-index: 110;
            overflow: hidden
        }

        .upload-menu.show {
            display: block;
            animation: fadeDown .15s ease
        }

        @keyframes fadeDown {
            from {
                opacity: 0;
                transform: translateY(-6px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .upload-menu button {
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: none;
            color: var(--t1);
            font-size: 13px;
            text-align: left;
            transition: background var(--tr);
            display: flex;
            align-items: center;
            gap: 10px
        }

        .upload-menu button:hover {
            background: var(--bg3)
        }

        /* === Êìç‰ΩúÊµÆÊù°ÔºàÈÄâ‰∏≠Êñá‰ª∂Êó∂Â∫ïÈÉ®ÂºπÂá∫Ôºâ=== */
        .action-bar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            z-index: 100;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, .5);
            transition: transform .3s cubic-bezier(.4, 0, .2, 1);
            backdrop-filter: blur(16px)
        }

        .action-bar.show {
            transform: translateX(-50%) translateY(0)
        }

        .action-bar .cnt {
            font-size: 13px;
            color: var(--t2);
            margin-right: 8px
        }

        .ab-btn {
            padding: 8px 18px;
            border-radius: var(--rs);
            font-size: 13px;
            font-weight: 500;
            border: 1px solid var(--border);
            background: var(--bg3);
            color: var(--t1);
            transition: all var(--tr)
        }

        .ab-btn:hover {
            background: var(--bg4)
        }

        .ab-btn.del {
            border-color: var(--red);
            color: var(--red)
        }

        .ab-btn.del:hover {
            background: rgba(248, 113, 113, .1)
        }

        /* === ‰∏ä‰º†ËøõÂ∫¶ === */
        .up-panel {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 200;
            width: 340px;
            max-height: 360px;
            overflow-y: auto;
            background: rgba(18, 18, 28, .94);
            backdrop-filter: blur(20px);
            border-radius: var(--r);
            border: 1px solid var(--border);
            box-shadow: 0 8px 40px rgba(0, 0, 0, .5);
            display: none
        }

        .up-panel.show {
            display: block;
            animation: slideUp .3s ease
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(16px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .up-hd {
            padding: 14px 16px;
            font-size: 13px;
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between
        }

        .up-item {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 12px
        }

        .up-item .un {
            color: var(--t2);
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap
        }

        .bar-bg {
            height: 3px;
            background: var(--bg4);
            border-radius: 2px;
            overflow: hidden
        }

        .bar-f {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--green));
            border-radius: 2px;
            transition: width .3s
        }

        /* === YouTube È£éÊ†ºËßÜÈ¢ëÊí≠ÊîæÂô® === */
        .yt {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 300;
            background: #0f0f0f;
            overflow: hidden
        }

        .yt.show {
            display: flex
        }

        .yt-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            padding: 24px;
            overflow-y: auto
        }

        .yt-video {
            width: 100%;
            max-height: 70vh;
            background: #000;
            flex-shrink: 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5)
        }

        .yt-video video {
            width: 100%;
            height: 100%;
            max-height: 70vh;
            outline: none;
            object-fit: contain
        }

        .yt-info {
            padding: 20px 0
        }

        .yt-info h2 {
            font-size: 20px;
            font-weight: 700;
            line-height: 1.4;
            color: #fff;
            margin-bottom: 8px
        }

        .yt-info .yt-sub {
            font-size: 14px;
            color: #aaa
        }

        .yt-close {
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 310;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, .6);
            border: none;
            color: #fff;
            font-size: 20px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all .2s
        }

        .yt-close:hover {
            background: rgba(255, 255, 255, .1);
            transform: scale(1.1)
        }

        /* ‰æßËæπÊ†èÊí≠ÊîæÂàóË°®ÔºàÂÆåÂÖ®ÂèÇÁÖßÂõæÁ§∫Ôºâ */
        .yt-side {
            width: 400px;
            padding: 24px 24px 24px 0;
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column
        }

        .yt-side-hd {
            padding-bottom: 16px;
            font-size: 16px;
            font-weight: 700;
            color: #fff
        }

        .pl {
            display: flex;
            flex-direction: column;
            gap: 12px
        }

        .pl-i {
            display: flex;
            gap: 12px;
            cursor: pointer;
            transition: all .2s;
            border-radius: 8px;
            padding: 4px
        }

        .pl-i:hover {
            background: rgba(255, 255, 255, .1)
        }

        .pl-i.act {
            background: rgba(255, 255, 255, 0.15)
        }

        .pl-i .pl-thumb {
            width: 160px;
            height: 90px;
            border-radius: 8px;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
            overflow: hidden;
            position: relative
        }

        .pl-i .pl-t-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 2px
        }

        .pl-i .pl-t {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
            color: #f1f1f1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 4px
        }

        .pl-i .pl-m {
            font-size: 12px;
            color: #aaa
        }

        /* === Â§ßÂéÇÁ∫ßÂõæÁâáËΩÆÊí≠ÁÅØÁÆ± === */
        .lb {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 400;
            background: rgba(0, 0, 0, .96)
        }

        .lb.show {
            display: flex;
            flex-direction: column
        }

        /* È°∂Ê†è */
        .lb-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            flex-shrink: 0
        }

        .lb-top .lb-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--t2)
        }

        .lb-top .lb-cnt {
            font-size: 13px;
            color: var(--t3)
        }

        .lb-top .lb-x {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, .06);
            border: none;
            color: #fff;
            font-size: 20px;
            transition: all var(--tr);
            display: flex;
            align-items: center;
            justify-content: center
        }

        .lb-top .lb-x:hover {
            background: rgba(255, 255, 255, .12)
        }

        /* ‰∏ªÂõæÂå∫ */
        .lb-stage {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            min-height: 0
        }

        .lb-stage img {
            max-width: 88vw;
            max-height: calc(100vh - 160px);
            object-fit: contain;
            border-radius: 4px;
            transition: opacity .3s, transform .3s;
            user-select: none
        }

        .lb-stage img.fade-out {
            opacity: 0;
            transform: scale(.97)
        }

        .lb-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: rgba(255, 255, 255, .06);
            border: none;
            color: #fff;
            font-size: 26px;
            backdrop-filter: blur(8px);
            transition: all var(--tr);
            display: flex;
            align-items: center;
            justify-content: center
        }

        .lb-arrow:hover {
            background: rgba(255, 255, 255, .14);
            transform: translateY(-50%) scale(1.05)
        }

        .lb-arrow.prev {
            left: 16px
        }

        .lb-arrow.next {
            right: 16px
        }

        /* Áº©Áï•ÂõæÊù° */
        .lb-strip {
            flex-shrink: 0;
            padding: 12px 20px;
            display: flex;
            gap: 8px;
            justify-content: center;
            overflow-x: auto
        }

        .lb-strip .lb-th {
            width: 64px;
            height: 44px;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            opacity: .45;
            transition: all var(--tr);
            flex-shrink: 0
        }

        .lb-strip .lb-th:hover {
            opacity: .75
        }

        .lb-strip .lb-th.act {
            opacity: 1;
            border-color: var(--accent)
        }

        .lb-strip .lb-th img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        /* === Êñ∞Âª∫Êñá‰ª∂Â§π === */
        .mdl-ov {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 500;
            background: rgba(0, 0, 0, .55);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center
        }

        .mdl-ov.show {
            display: flex
        }

        .mdl {
            background: var(--bg2);
            border-radius: var(--r);
            border: 1px solid var(--border);
            padding: 28px;
            width: 380px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, .5)
        }

        .mdl h3 {
            font-size: 16px;
            margin-bottom: 16px
        }

        .mdl input {
            width: 100%;
            padding: 11px 16px;
            border-radius: var(--rs);
            background: var(--bg0);
            border: 1px solid var(--border);
            color: var(--t1);
            font-size: 14px;
            outline: none;
            transition: border-color var(--tr)
        }

        .mdl input:focus {
            border-color: var(--accent)
        }

        .mdl .macts {
            display: flex;
            gap: 10px;
            margin-top: 18px;
            justify-content: flex-end
        }

        .mbtn {
            padding: 9px 20px;
            border-radius: var(--rs);
            font-size: 13px;
            font-weight: 500;
            border: 1px solid var(--border);
            background: var(--bg3);
            color: var(--t1);
            transition: all var(--tr)
        }

        .mbtn:hover {
            background: var(--bg4)
        }

        .mbtn.primary {
            background: var(--accent);
            border-color: transparent;
            color: #fff
        }

        .mbtn.primary:hover {
            opacity: .9
        }

        @media(max-width:768px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 8px
            }

            .header {
                padding: 0 14px;
                height: 48px
            }

            .main {
                padding: 14px
            }

            .yt-side {
                display: none
            }

            .lb-strip .lb-th {
                width: 48px;
                height: 32px
            }
        }
    </style>
</head>

<body>

    <!-- È°∂Ê†è -->
    <div class="header">
        <a class="logo" onclick="nav('')">üî• FireCloud</a>
        <button class="back-btn hidden" id="backBtn" onclick="goUp()" title="ËøîÂõû‰∏äÁ∫ß">‚Üê</button>
        <div class="nav" id="nav"></div>
        <div class="header-actions" style="position:relative">
            <a id="ipBtn" class="ip-badge" title="Â±ÄÂüüÁΩëËÆøÈóÆ" target="_blank" style="display:none">
                <span></span>
                <p id="ipText">192.168.x.x</p>
            </a>
            <button class="icon-btn" onclick="showMkdir()" title="Êñ∞Âª∫Êñá‰ª∂Â§π">üìÅ</button>
            <button class="icon-btn" id="upBtn" onclick="toggleUpMenu()" title="‰∏ä‰º†">‚¨Ü</button>
            <div class="upload-menu" id="upMenu">
                <button onclick="$('#fi').click();hideUpMenu()">üìÑ ‰∏ä‰º†Êñá‰ª∂</button>
                <button onclick="$('#fdi').click();hideUpMenu()">üìÇ ‰∏ä‰º†Êñá‰ª∂Â§π</button>
            </div>
        </div>
    </div>

    <!-- ÊãñÊãΩË¶ÜÁõñÂ±Ç -->
    <div class="drag-overlay" id="dragOv">
        <div class="drag-box">
            <p>üì•</p>
            <p>ÊùæÊâã‰∏ä‰º†Êñá‰ª∂</p>
        </div>
    </div>

    <!-- ‰∏ªÂÜÖÂÆπ -->
    <div class="main" id="main">
        <div class="chips" id="chips">
            <div class="chip act">ÂÖ®ÈÉ®</div>
            <div class="chip">ËßÜÈ¢ë</div>
            <div class="chip">ËØæ‰ª∂</div>
            <div class="chip">ÂõæÁâá</div>
            <div class="chip">ÂéãÁº©ÂåÖ</div>
            <div class="chip">ÊñáÊ°£</div>
        </div>
        <div class="grid" id="grid"></div>
    </div>

    <input type="file" id="fi" multiple hidden>
    <input type="file" id="fdi" webkitdirectory hidden>

    <!-- ÈÄâ‰∏≠Êìç‰ΩúÊµÆÊù° -->
    <div class="action-bar" id="abar">
        <span class="cnt" id="selCnt"></span>
        <button class="ab-btn" onclick="clearSel()">ÂèñÊ∂àÈÄâÊã©</button>
        <button class="ab-btn del" onclick="delSel()">üóë Âà†Èô§</button>
    </div>

    <!-- ‰∏ä‰º†ËøõÂ∫¶ -->
    <div class="up-panel" id="upPanel">
        <div class="up-hd"><span>‰∏ä‰º†‰∏≠</span><span id="uc"></span></div>
        <div id="upList"></div>
    </div>

    <!-- YouTube ËßÜÈ¢ëÊí≠ÊîæÂô® -->
    <div class="yt" id="yt">
        <button class="yt-close" onclick="closeVP()">‚úï</button>
        <div class="yt-body">
            <div class="yt-video"><video id="vid" controls></video></div>
            <div class="yt-info">
                <h2 id="vtitle"></h2>
                <div class="yt-sub" id="vsub"></div>
            </div>
        </div>
        <div class="yt-side">
            <div class="yt-side-hd">Êí≠ÊîæÂàóË°® <span id="plCnt"></span></div>
            <div class="pl" id="pl"></div>
        </div>
    </div>

    <!-- ÂõæÁâáÁÅØÁÆ± -->
    <div class="lb" id="lb">
        <div class="lb-top">
            <span class="lb-title" id="lbTitle"></span>
            <span class="lb-cnt" id="lbCnt"></span>
            <button class="lb-x" onclick="closeLB()">‚úï</button>
        </div>
        <div class="lb-stage">
            <button class="lb-arrow prev" onclick="lbGo(-1)">‚Äπ</button>
            <img id="lbImg" src="" alt="">
            <button class="lb-arrow next" onclick="lbGo(1)">‚Ä∫</button>
        </div>
        <div class="lb-strip" id="lbStrip"></div>
    </div>

    <!-- Êñ∞Âª∫Êñá‰ª∂Â§π -->
    <div class="mdl-ov" id="mkdirM">
        <div class="mdl">
            <h3>Êñ∞Âª∫Êñá‰ª∂Â§π</h3>
            <input type="text" id="mkdirN" placeholder="ËæìÂÖ•ÂêçÁß∞">
            <div class="macts">
                <button class="mbtn" onclick="$('#mkdirM').classList.remove('show')">ÂèñÊ∂à</button>
                <button class="mbtn primary" onclick="doMkdir()">ÂàõÂª∫</button>
            </div>
        </div>
    </div>

    <script>
        const $ = s => document.querySelector(s), $$ = s => document.querySelectorAll(s);
        let cur = '', files = [], sel = new Set(), imgs = [], vids = [], lbi = 0;
        const imgE = /\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i, vidE = /\.(mp4|webm|mkv|avi|mov|flv)$/i;
        const fileUrl = (name) => { const fp = cur ? cur + '/' + name : name; return '/files/' + encodeURIComponent(fp).replace(/%2F/g, '/'); };

        // Ëé∑ÂèñÁä∂ÊÄÅÂπ∂ÊòæÁ§∫ IP
        fetch('/api/status').then(r => r.json()).then(data => {
            if (data.ip) {
                const btn = $('#ipBtn');
                $('#ipText').innerText = data.ip;
                btn.href = `http://${data.ip}${location.port ? ':' + location.port : ''}`;
                btn.style.display = 'flex';
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            cur = new URLSearchParams(location.search).get('path') || '';
            load(); initDrag();
            $('#fi').onchange = e => { up([...e.target.files]); e.target.value = ''; };
            $('#fdi').onchange = e => { up([...e.target.files]); e.target.value = ''; };
            document.addEventListener('click', e => { if (!e.target.closest('#upBtn') && !e.target.closest('#upMenu')) hideUpMenu(); });
        });
        window.addEventListener('popstate', () => { cur = new URLSearchParams(location.search).get('path') || ''; load(); });

        // === Êï∞ÊçÆÂä†ËΩΩ ===
        async function load() {
            const r = await fetch(`/api/list?path=${encodeURIComponent(cur)}`);
            const d = await r.json(); files = d.files || []; sel.clear(); updAbar();
            imgs = files.filter(f => !f.isDir && imgE.test(f.name));
            vids = files.filter(f => !f.isDir && vidE.test(f.name));
            renderNav(); renderGrid();
        }

        // === ÂØºËà™ ===
        function renderNav() {
            $('#backBtn').classList.toggle('hidden', !cur);
            let h = '<a href="#" data-p="">Ê†πÁõÆÂΩï</a>';
            if (cur) {
                const ps = cur.split('/').filter(Boolean); let p = '';
                ps.forEach((s, i) => {
                    p += (p ? '/' : '') + s; h += '<span class="sep">‚Ä∫</span>';
                    h += i === ps.length - 1 ? `<span class="cur">${esc(s)}</span>` : `<a href="#" data-p="${esc(p)}">${esc(s)}</a>`;
                });
            }
            $('#nav').innerHTML = h;
            $$('#nav a').forEach(a => a.onclick = e => { e.preventDefault(); nav(a.dataset.p); });
        }
        function goUp() {
            if (!cur) return;
            const ps = cur.split('/').filter(Boolean);
            ps.pop();
            nav(ps.join('/'));
        }
        function nav(p) { cur = p; history.pushState(null, '', `?path=${encodeURIComponent(cur)}`); load(); }

        // === Êñá‰ª∂ÁΩëÊ†º ===
        function renderGrid() {
            const g = $('#grid');
            if (!files.length) { g.innerHTML = '<div class="empty"><span>üì≠</span><p>Á©∫Êñá‰ª∂Â§π</p></div>'; return; }
            g.innerHTML = files.map(f => {
                let th = ''; const u = fileUrl(f.name);
                if (f.isDir) th = '<span>üìÅ</span>';
                else if (imgE.test(f.name)) th = `<img src="${u}" loading="lazy" alt="">`;
                else if (vidE.test(f.name)) th = `<img class="v-thumb" data-u="${u}" style="display:none"><span>üé¨</span>`;
                else th = `<span>${ico(f.name)}</span>`;

                return `<div class="item" data-n="${esc(f.name)}" onclick="click_(event,'${esc(f.name)}',${f.isDir})">
                    <div class="thumb-box">
                        <div class="thumb-inner" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:48px;background:#1a1a1a">
                            ${th}
                        </div>
                        ${f.isDir ? '' : `<div class="size-tag">${fmtSz(f.size)}</div>`}
                    </div>
                    <div class="card-body">
                        <div class="card-avatar">${f.isDir ? 'üìÅ' : (vidE.test(f.name) ? 'üé¨' : (imgE.test(f.name) ? 'üñºÔ∏è' : 'üìÑ'))}</div>
                        <div class="card-text">
                            <div class="fname">${esc(f.name)}</div>
                            <div class="fmeta">FireCloud ¬∑ ${f.isDir ? 'Êñá‰ª∂Â§π' : 'Êñá‰ª∂'}</div>
                        </div>
                        <div class="card-menu" onclick="event.stopPropagation();togSel('${esc(f.name)}')">‚ãÆ</div>
                    </div>
                </div>`;
            }).join('');
            genVidThumbs();
        }

        // === ËßÜÈ¢ëËá™Âä®Êà™Â∏ß ===
        function genVidThumbs() {
            $$('.v-thumb').forEach(img => {
                const video = document.createElement('video');
                video.src = img.dataset.u;
                video.preload = 'metadata'; video.muted = true; video.currentTime = 1;
                video.onseeked = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                    img.src = canvas.toDataURL('image/jpeg', 0.7);
                    img.style.display = 'block';
                    if (img.nextElementSibling) img.nextElementSibling.style.display = 'none';
                };
            });
        }
        function ico(n) {
            n = n.toLowerCase();
            if (/\.(mp3|wav|ogg|flac)$/.test(n)) return 'üéµ'; if (/\.pdf$/.test(n)) return 'üìï';
            if (/\.(doc|docx)$/.test(n)) return 'üìò'; if (/\.(xls|xlsx)$/.test(n)) return 'üìó';
            if (/\.(ppt|pptx)$/.test(n)) return 'üìô'; if (/\.(zip|rar|7z)$/.test(n)) return 'üì¶';
            if (/\.(html|htm)$/.test(n)) return 'üåê'; if (/\.(js|go|py|java|c|cpp)$/.test(n)) return 'üíª';
            return 'üìÑ';
        }

        function click_(e, name, isDir) {
            if (e.target.classList.contains('ck')) return;
            if (isDir) { nav(cur ? cur + '/' + name : name); }
            else if (imgE.test(name)) { lbi = imgs.findIndex(f => f.name === name); openLB(); }
            else if (vidE.test(name)) { openVP(name); }
            else window.open(fileUrl(name), '_blank');
        }

        // === ÈÄâÊã© ===
        function togSel(n) {
            sel.has(n) ? sel.delete(n) : sel.add(n);
            $$('.item').forEach(el => el.classList.toggle('sel', sel.has(el.dataset.n))); updAbar();
        }
        function clearSel() { sel.clear(); $$('.item').forEach(el => el.classList.remove('sel')); updAbar(); }
        function updAbar() { const a = $('#abar'); if (sel.size) { a.classList.add('show'); $('#selCnt').textContent = `Â∑≤ÈÄâ ${sel.size} È°π`; } else a.classList.remove('show'); }
        async function delSel() {
            if (!confirm(`Á°ÆÂÆöÂà†Èô§ ${sel.size} ‰∏™È°πÁõÆÔºü`)) return;
            for (const n of sel) { await fetch(`/api/delete?path=${encodeURIComponent(cur ? cur + '/' + n : n)}`, { method: 'DELETE' }); }
            load();
        }

        // === ‰∏ä‰º†ËèúÂçï ===
        function toggleUpMenu() { $('#upMenu').classList.toggle('show'); }
        function hideUpMenu() { $('#upMenu').classList.remove('show'); }

        // === ÊãñÊãΩ‰∏ä‰º† ===
        let dragCnt = 0;
        function initDrag() {
            const b = document.body, ov = $('#dragOv');
            b.addEventListener('dragenter', e => { e.preventDefault(); dragCnt++; ov.classList.add('show'); });
            b.addEventListener('dragleave', e => { e.preventDefault(); dragCnt--; if (dragCnt <= 0) { dragCnt = 0; ov.classList.remove('show'); } });
            b.addEventListener('dragover', e => e.preventDefault());
            b.addEventListener('drop', async e => {
                e.preventDefault(); dragCnt = 0; ov.classList.remove('show');
                const items = e.dataTransfer.items; if (!items) return;
                const all = [], ps = [];
                for (const it of items) { const en = it.webkitGetAsEntry ? it.webkitGetAsEntry() : null; if (en) ps.push(trav(en, '', all)); }
                await Promise.all(ps); if (all.length) upPath(all);
            });
        }
        function trav(en, base, res) {
            return new Promise(ok => {
                if (en.isFile) en.file(f => { res.push({ file: f, rel: base + f.name }); ok(); });
                else if (en.isDirectory) {
                    const rd = en.createReader(); const go = () => {
                        rd.readEntries(async ents => {
                            if (!ents.length) { ok(); return; } for (const e of ents) await trav(e, base + en.name + '/', res); go();
                        })
                    }; go();
                }
            });
        }
        function up(fl) { upPath(fl.map(f => ({ file: f, rel: f.webkitRelativePath || f.name }))); }
        async function upPath(items) {
            const pnl = $('#upPanel'), list = $('#upList'), cnt = $('#uc'); pnl.classList.add('show'); list.innerHTML = ''; let done = 0;
            for (let i = 0; i < items.length; i++) {
                const { file, rel } = items[i]; cnt.textContent = `${done}/${items.length}`;
                const id = 'u' + i; list.innerHTML += `<div class="up-item" id="${id}"><div class="un">${esc(rel)}</div><div class="bar-bg"><div class="bar-f" style="width:0%"></div></div></div>`;
                list.scrollTop = list.scrollHeight;
                const path = cur ? cur + '/' + rel : rel;
                await upOne(file, path, $(`#${id} .bar-f`)); done++; cnt.textContent = `${done}/${items.length}`;
            }
            setTimeout(() => { pnl.classList.remove('show'); load(); }, 1000);
        }
        function upOne(file, path, bar) {
            return new Promise((ok, no) => {
                const x = new XMLHttpRequest(); x.open('POST', `/api/upload?path=${encodeURIComponent(path)}`);
                x.upload.onprogress = e => { if (e.lengthComputable && bar) bar.style.width = Math.round(e.loaded / e.total * 100) + '%'; };
                x.onload = () => { if (bar) bar.style.width = '100%'; ok(); }; x.onerror = () => no(); x.send(file);
            });
        }

        // === Êñ∞Âª∫Êñá‰ª∂Â§π ===
        function showMkdir() { $('#mkdirM').classList.add('show'); $('#mkdirN').value = ''; setTimeout(() => $('#mkdirN').focus(), 50); }
        async function doMkdir() {
            const n = $('#mkdirN').value.trim(); if (!n) return;
            await fetch(`/api/mkdir?path=${encodeURIComponent(cur ? cur + '/' + n : n)}`, { method: 'POST' });
            $('#mkdirM').classList.remove('show'); load();
        }

        // === YouTube ËßÜÈ¢ëÊí≠ÊîæÂô® ===
        function openVP(name) {
            const v = $('#vid'); v.src = fileUrl(name); $('#vtitle').textContent = name;
            const idx = vids.findIndex(f => f.name === name);
            $('#vsub').textContent = `${vids.length} ‰∏™ËßÜÈ¢ë ¬∑ Ê≠£Âú®Êí≠Êîæ #${idx + 1}`;
            $('#plCnt').textContent = `Êí≠ÊîæÂàóË°®`;
            $('#yt').classList.add('show'); document.body.style.overflow = 'hidden';
            // Ê∏≤ÊüìÊí≠ÊîæÂàóË°®
            $('#pl').innerHTML = vids.map((f, i) => `<div class="pl-i${f.name === name ? ' act' : ''}" onclick="swVid('${esc(f.name)}')">
    <div class="pl-thumb">
        <img class="v-thumb" data-u="${fileUrl(f.name)}" style="display:none;width:100%;height:100%;object-fit:contain">
        <span>üé¨</span>
    </div>
    <div class="pl-t-box">
        <div class="pl-t">${esc(f.name)}</div>
        <div class="pl-m">${fmtSz(f.size)}</div>
    </div></div>`).join('');
            v.play().catch(() => { });
            v.onended = () => { if (idx < vids.length - 1) swVid(vids[idx + 1].name); };

            // Á´ãÂç≥Ëß¶ÂèëÊà™Â∏ß
            genVidThumbs();
        }
        function swVid(name) {
            const v = $('#vid'); v.src = fileUrl(name); $('#vtitle').textContent = name;
            const idx = vids.findIndex(f => f.name === name);
            $('#vsub').textContent = `${vids.length} ‰∏™ËßÜÈ¢ë ¬∑ Ê≠£Âú®Êí≠Êîæ #${idx + 1}`;
            $$('.pl-i').forEach((el, i) => el.classList.toggle('act', i === idx));
            v.play().catch(() => { });
            v.onended = () => { if (idx < vids.length - 1) swVid(vids[idx + 1].name); };
        }
        function closeVP() { $('#vid').pause(); $('#vid').removeAttribute('src'); $('#vid').load(); $('#yt').classList.remove('show'); document.body.style.overflow = ''; }

        // === ÂõæÁâáÁÅØÁÆ± ===
        function openLB() {
            $('#lb').classList.add('show'); document.body.style.overflow = 'hidden';
            // Ê∏≤ÊüìÁº©Áï•ÂõæÊù°
            $('#lbStrip').innerHTML = imgs.map((f, i) => `<div class="lb-th${i === lbi ? ' act' : ''}" onclick="lbJump(${i})"><img src="${fileUrl(f.name)}" alt=""></div>`).join('');
            updLB(false);
        }
        function closeLB() { $('#lb').classList.remove('show'); document.body.style.overflow = ''; }
        function lbGo(d) { lbi = (lbi + d + imgs.length) % imgs.length; updLB(true); }
        function lbJump(i) { lbi = i; updLB(true); }
        function updLB(animate) {
            const f = imgs[lbi], img = $('#lbImg');
            if (animate) { img.classList.add('fade-out'); setTimeout(() => { img.src = fileUrl(f.name); img.classList.remove('fade-out'); }, 150); }
            else { img.src = fileUrl(f.name); }
            $('#lbTitle').textContent = f.name;
            $('#lbCnt').textContent = `${lbi + 1} / ${imgs.length}`;
            $$('.lb-th').forEach((el, i) => el.classList.toggle('act', i === lbi));
            // ÊªöÂä®Áº©Áï•ÂõæÊù°
            const strip = $('#lbStrip'), th = strip.children[lbi];
            if (th) th.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }

        // === ÈîÆÁõò ===
        document.addEventListener('keydown', e => {
            if ($('#lb').classList.contains('show')) { if (e.key === 'ArrowLeft') lbGo(-1); if (e.key === 'ArrowRight') lbGo(1); if (e.key === 'Escape') closeLB(); }
            if ($('#yt').classList.contains('show') && e.key === 'Escape') closeVP();
            if ($('#mkdirM').classList.contains('show') && e.key === 'Enter') doMkdir();
            if (e.key === 'Escape') { $('#mkdirM').classList.remove('show'); clearSel(); }
        });

        // === Â∑•ÂÖ∑ ===
        function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
        function fmtSz(b) { if (!b) return '0 B'; const k = 1024, u = ['B', 'KB', 'MB', 'GB', 'TB'], i = Math.floor(Math.log(b) / Math.log(k)); return (b / Math.pow(k, i)).toFixed(i ? 1 : 0) + ' ' + u[i]; }
    </script>
</body>

</html>